# Налаштування TrueNAS

Цей посібник пояснює, як налаштувати Gramps Web на TrueNAS Community Edition 25.04.

!!! warning
    Цей посібник призначений для TrueNAS Community Edition 25.04 або новіших версій, які впровадили нову систему додатків на основі Docker Compose. Він не застосовується до попередніх версій TrueNAS.

## Попередні вимоги

- TrueNAS Community Edition 25.04 або новіша версія
- Базове знайомство з веб-інтерфейсом TrueNAS
- Набір даних для зберігання даних Gramps Web

## Огляд

TrueNAS Community Edition 25.04 впровадила нову систему додатків на основі Docker Compose, яка замінила попередній підхід на основі Helm chart. Цей посібник проведе вас через створення власного додатка для Gramps Web за допомогою Docker Compose.

## Крок 1: Підготовка сховища

1. Перейдіть до **Datasets** у веб-інтерфейсі TrueNAS
2. Створіть новий набір даних для Gramps Web (наприклад, `grampsweb`). Зверніть увагу на повний шлях до цього набору даних, наприклад, `/mnt/storage/grampsweb`, оскільки він знадобиться вам пізніше.

Створіть підкаталоги для різних компонентів:
- `users` - База даних користувачів
- `database` - Файл(и) бази даних Gramps
- `media` - Медіа файли

## Крок 2: Створення додатка Docker Compose

1. Перейдіть до **Apps** у веб-інтерфейсі TrueNAS
2. Натисніть на **Discover Apps**
3. Знайдіть "Gramps Web" і натисніть на нього
4. Натисніть "Install"

Це перенесе вас на сторінку конфігурації додатка.

## Крок 3: Налаштування додатка

### Налаштування Gramps Web

- **Часовий пояс:** Встановіть на ваш місцевий часовий пояс (наприклад, `Europe/Berlin`)
- **Пароль Redis:** Встановіть пароль для Redis. Він буде використовуватися лише внутрішньо додатком.
- **Вимкнути телеметрію:** будь ласка, залиште цей пункт незакритим – див. [тут для деталей](telemetry.md).
- **Секретний ключ:** важливо, щоб ви встановили його на сильне, унікальне значення. Див. [конфігурацію сервера](configuration.md#existing-configuration-settings) для інструкцій, як згенерувати випадковий ключ.
- **Додаткові змінні середовища:** Вам потрібно буде встановити всі додаткові [опції конфігурації](configuration.md) як змінні середовища з префіксом `GRAMPSWEB_`. Будь ласка, уважно перевірте [документацію конфігурації](configuration.md) – наприклад, той факт, що булеві значення потрібно встановлювати як `true` або `false` (все в нижньому регістрі) у випадку змінних середовища, що є поширеною помилкою.

Будь ласка, **принаймні** встановіть `GRAMPSWEB_BASE_URL` на URL, за яким ваш екземпляр Gramps Web буде доступний – це необхідно для належної роботи.

Ви також можете захотіти налаштувати конфігурацію електронної пошти на цьому етапі. Якщо ви це зробите, ви можете пропустити крок конфігурації електронної пошти в майстрі налаштування. Відповідні змінні середовища:

- `GRAMPSWEB_EMAIL_HOST`
- `GRAMPSWEB_EMAIL_HOST_USER`
- `GRAMPSWEB_EMAIL_HOST_PASSWORD`
- `GRAMPSWEB_DEFAULT_FROM_EMAIL`

Усі налаштування конфігурації можна змінити пізніше, натиснувши "Edit" у інтерфейсі додатків TrueNAS.

### Налаштування сховища

- **Сховище користувачів:** Виберіть шлях до каталогу `users`, який ви створили раніше.
- **Сховище індексу:** Ви можете залишити налаштування за замовчуванням "ixVolume (Dataset created automatically by the system)"
- **Сховище кешу мініатюр:** Ви можете залишити налаштування за замовчуванням "ixVolume (Dataset created automatically by the system)"
- **Сховище кешу:** Ви можете залишити налаштування за замовчуванням "ixVolume (Dataset created automatically by the system)"
- **Сховище медіа:** Виберіть шлях до каталогу `media`, який ви створили раніше.
- **Сховище бази даних Gramps:** Виберіть шлях до каталогу `database`, який ви створили раніше.

### Налаштування ресурсів

Рекомендуємо виділити принаймні 2 процесори та 4096 МБ оперативної пам'яті для забезпечення безперебійної роботи.

## Крок 4: Доступ до Gramps Web

Після розгортання додатка ви можете отримати доступ до Gramps Web, натиснувши кнопку "Web UI" в інтерфейсі додатків TrueNAS. Ви повинні побачити майстра налаштування "Welcome to Gramps Web".

Якщо ви хочете дозволити користувачам отримати доступ до вашого інтерфейсу Gramps Web, **не** виставляйте додаток безпосередньо в інтернет, а переходьте до наступного кроку.

## Крок 5: Налаштування зворотного проксі

Щоб безпечно виставити ваш екземпляр Gramps Web для користувачів, рекомендується налаштувати зворотний проксі. Це дозволяє вам керувати SSL/TLS сертифікатами та контролювати доступ.

Найпростіший варіант – використовувати офіційний додаток TrueNAS Nginx Proxy Manager. Знайдіть додаток в інтерфейсі додатків TrueNAS і встановіть його. Ви можете залишити всі налаштування за замовчуванням, але рекомендуємо встановити одну додаткову змінну середовища: `DISABLE_IPV6` зі значенням `true`, щоб уникнути потенційних проблем, пов'язаних з IPv6.

Після розгортання відкрийте веб-інтерфейс Nginx Proxy Manager і створіть новий проксі-хост з такими налаштуваннями:

- Схема: `http`
- Перенаправлення Ім'я хоста / IP: ім'я вашого сервера TrueNAS (наприклад, `truenas`)
- Перенаправлення порту: порт, призначений для вашого додатка Gramps Web (перевірте інтерфейс додатків TrueNAS для точного порту)
- У вкладці "SSL" встановіть прапорець "Force SSL"
- У розділі "SSL Certificates" виберіть "Add SSL Certificate" > "Let's Encrypt", щоб створити новий сертифікат Let's Encrypt для вашого домену.

Будь ласка, дивіться [документацію Nginx Proxy Manager](https://nginxproxymanager.com/guide/) для отримання додаткових деталей щодо налаштування вашого маршрутизатора та отримання SSL сертифікатів.
